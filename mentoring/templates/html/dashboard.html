{% load i18n %}
<div class="pb-dashboard">
  <h1>{{display_name}}</h1>

  {% if visual_repr %}
  <div class="pb-dashboard-visual">
    <svg width="{{visual_repr.width}}" height="{{visual_repr.height}}">
      <!-- Filter definitions -->
      {% for layer in visual_repr.layers %}
        {% if layer.color %}
          <filter id="{{layer.id}}">
            <feFlood flood-color="{{layer.color}}" result="flood" />
            <feBlend in="flood" in2="SourceGraphic" mode="multiply" />
          </filter>
          <mask id="{{layer.id}}-mask" maskUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%">
            <image xlink:href="{{layer.url}}" x="0" y="0" height="100%" width="100%" />
          </mask>
        {% endif %}
      {% endfor %}
      <!-- Layer images -->
      {% for layer in visual_repr.layers %}
        {% if layer.color %}
          <rect x="0" y="0" height="100%" width="100%" fill="{{layer.color}}" mask="url(#{{layer.id}}-mask)" />
        {% else %}
          <image xlink:href="{{layer.url}}" x="0" y="0" height="100%" width="100%" />
        {% endif %}
      {% endfor %}
    </svg>
  </div>
  {% endif %}


  <table>
    {% for block in blocks %}
      <thead>
        <th colspan=2>{{ block.display_name }}</th>
      </thead>
      <tbody>
        {% for mcq in block.mcqs %}
          <tr>
            <td>{{ mcq.display_name }}</td>
            <td {% if mcq.color %}style="background-color: {{mcq.color}};"{% endif %}>
              {% if mcq.value %}{{ mcq.value }}{% endif %}
            </td>
          </tr>
        {% endfor %}
        {% if block.has_average %}
         <tr class="avg-row">
            <td>{% trans "Average" %}</td>
            <td {% if block.average_color %}style="background-color: {{block.average_color}};"{% endif %}>{{ block.average|floatformat }}</td>
          </tr>
        {% endif %}
      </tbody>
    {% endfor %}
  </table>

  {% if report_url %}
    <br>
    <p><a href="{{ report_url }}">{% trans "Download report" %}</a></p>
  {% endif %}
</div>
